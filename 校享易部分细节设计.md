# 校享易：校园闲置物品共享平台

### 详细设计

1. **数据库设计**：略




2. **时序与流程设计**：

   - **关键业务流程的时序图**：
     
     - **用户注册流程**：用户输入信息 -> 前端发送注册请求 -> 后端验证信息（如邮箱格式、学号认证）-> 数据库存储用户信息 -> 返回注册结果。
     
       ``` mermaid
       sequenceDiagram
           actor User as 用户
           participant Frontend as 前端 (Vue.js App)
           participant Backend as 后端 (Django REST Framework)
           participant Database as 数据库 (MySQL)
       
           User->>Frontend: 访问注册页面，填写用户名、密码、邮箱
           Frontend->>Frontend: 客户端表单校验 (格式、非空)
           Frontend->>Backend: 发送注册请求 (POST /users/register/)
           Backend->>Backend: 接收请求，验证数据合法性 (如邮箱格式、用户名/邮箱是否已存在)
           Backend->>Database: 查询用户名或邮箱是否已存在
           Database-->>Backend: 返回查询结果
           alt 用户名或邮箱已存在
               Backend-->>Frontend: 返回错误响应 (400 Bad Request)
               Frontend-->>User: 显示错误信息
           else 用户名和邮箱均可用
               Backend->>Backend: 对密码进行哈希处理
               Backend->>Database: 存储新用户数据 (用户名、密码哈希、邮箱等)
               Database-->>Backend: 返回存储结果
               Backend-->>Frontend: 返回成功响应 (201 Created)
               Frontend-->>User: 显示注册成功信息，引导登录
           end
       ```
     
       
     
     - **用户登录流程**：用户输入凭证 -> 前端发送登录请求 -> 后端验证凭证 -> 生成并返回认证Token。
     
       ``` mermaid
       sequenceDiagram
           actor User as 用户
           participant Frontend as 前端 (Vue.js App)
           participant Backend as 后端 (Django REST Framework)
           participant Database as 数据库 (MySQL)
       
           User->>Frontend: 访问登录页面，输入用户名和密码
           Frontend->>Backend: 发送登录请求 (POST /users/login/)
           Backend->>Backend: 接收请求，查找用户
           Backend->>Database: 根据用户名查询用户记录
           Database-->>Backend: 返回用户记录
           alt 用户不存在或密码不匹配
               Backend->>Backend: 验证密码 (哈希值比对)
               Backend-->>Frontend: 返回错误响应 (401 Unauthorized)
               Frontend-->>User: 显示登录失败信息
           else 用户存在且密码匹配
               Backend->>Backend: 生成认证Token (JWT)
               Backend-->>Frontend: 返回成功响应 (200 OK) 和 Token
               Frontend->>Frontend: 存储Token (如localStorage)
               Frontend-->>User: 登录成功，跳转到主页或个人中心
           end
       ```
     
       
     
     - **发布物品流程**：用户填写物品信息（标题、描述、价格、分类、图片）-> 前端上传图片、发送发布请求 -> 后端处理图片、保存物品数据 -> 返回发布结果。
     
       ``` mermaid
       sequenceDiagram
           actor User as 用户
           participant Frontend as 前端 (Vue.js App)
           participant Backend as 后端 (Django REST Framework)
           participant Database as 数据库 (MySQL)
           participant CloudStorage as 云存储 (如OSS/七牛云,可选)
       
           User->>Frontend: 访问发布物品页面
           User->>Frontend: 填写物品信息 (标题、描述、价格、分类)
           User->>Frontend: 选择并上传物品图片 (多张)
           Frontend->>CloudStorage: (可选) 上传图片文件
           CloudStorage-->>Frontend: (可选) 返回图片URL
           Frontend->>Backend: 发送发布物品请求 (POST /items/)
           Frontend->>Backend: 请求头包含认证Token，请求体包含物品数据和图片URL列表
           Backend->>Backend: 接收请求，验证Token和数据合法性
           Backend->>Database: 存储物品数据 (item_id, owner_id, category_id, title, description, price, status等)
           Database-->>Backend: 返回存储结果
           Backend-->>Frontend: 返回成功响应 (201 Created)
           Frontend-->>User: 显示发布成功信息，跳转到物品详情页或我的发布
       ```
     
       
     
     - **购买商品流程**：用户选择商品 -> 前端发起购买请求 -> 后端创建订单 -> 更新物品状态 -> 返回订单信息。
     
       ```mermaid
       sequenceDiagram
           actor User as 用户 (买方)
           participant Frontend as 前端 (Vue.js App)
           participant Backend as 后端 (Django REST Framework)
           participant Database as 数据库 (MySQL)
           actor ItemOwner as 物品所有者 (卖方)
       
           User->>Frontend: 浏览物品列表/详情页，选择购买物品
           Frontend->>Backend: 发送创建订单请求 (POST /orders/)
           Frontend->>Backend: 请求头包含认证Token，请求体包含item_id
           Backend->>Backend: 接收请求，验证Token，校验物品状态 (是否在售，是否是自己发布的)
           Backend->>Database: 查询物品信息，检查库存或状态
           Database-->>Backend: 返回物品信息
           alt 物品不可购买 (已售、非在售状态、自己发布的)
               Backend-->>Frontend: 返回错误响应 (400 Bad Request)
               Frontend-->>User: 显示购买失败信息
           else 物品可购买
               Backend->>Database: 创建新订单记录 (order_id, item_id, buyer_id, status="进行中")
               Backend->>Database: 更新物品状态为 "进行中" (或锁定)
               Database-->>Backend: 返回订单创建结果和物品更新结果
               Backend-->>Frontend: 返回成功响应 (201 Created) 和订单信息
               Frontend-->>User: 显示订单创建成功信息，跳转到订单详情页
               Backend->>ItemOwner: (可选) 通知物品所有者有新订单
           end
       ```
     
       
     
     - **物品检索流程**：用户输入关键词或选择分类 -> 前端发送查询请求 -> 后端查询数据库 -> 返回物品列表。
     
       ```mermaid
       sequenceDiagram
           actor User as 用户
           participant Frontend as 前端 (Vue.js App)
           participant Backend as 后端 (Django REST Framework)
           participant Database as 数据库 (MySQL)
       
           User->>Frontend: 在搜索框输入关键词 或 选择分类
           Frontend->>Backend: 发送获取物品列表请求 (GET /items/)
           Frontend->>Backend: 请求包含查询参数 (search, category_id, page, page_size)
           Backend->>Backend: 接收请求，解析查询参数
           Backend->>Database: 根据查询参数从物品表进行数据查询、过滤和分页
           Database-->>Backend: 返回匹配的物品列表数据
           Backend-->>Frontend: 返回成功响应 (200 OK) 和物品列表数据
           Frontend->>Frontend: 渲染物品列表
           Frontend-->>User: 显示查询结果
       ```
     
       

   

3. **模块设计**：

   - 后端模块：
     - 用户管理模块：负责用户注册、登录、认证、个人信息管理。
     - 物品管理模块：负责物品的发布、查询、更新、删除、分类管理。
     - 订单管理模块：负责订单的创建、查询、状态更新。
     - 消息/沟通模块：如果实现在线沟通，需要设计消息的发送、接收、存储。
     - 图片上传模块：负责图片的存储和管理。
   - 前端模块/组件：
     - 认证模块：登录组件、注册组件。
     - 用户中心模块：个人信息页、我的发布、我的订单等。
     - 物品展示模块：物品列表组件、物品详情组件、物品卡片组件。
     - 物品发布模块：发布表单组件、图片上传组件。
     - 搜索与筛选模块：搜索框组件、分类导航组件。
     - 订单模块：订单列表、订单详情组件。
     - 消息组件：聊天界面、消息列表。



### 原型设计

#### **1. 用户流程图**

##### 1.1 核心用户流程：发布物品与订单管理

```mermaid
graph TD
    A[用户注册/登录] --> B{发布闲置物品};
    B --> C[填写物品信息<br>上传图片];
    C --> D[预览并发布];
    D --> E{物品发布成功};
    E --> F[我的发布列表];
    E --> G[物品详情页];

    subgraph 购买流程
        H[浏览物品列表/搜索] --> I[查看物品详情];
        I --> J{决定购买};
        J --> K[创建订单];
        K --> L{订单创建成功};
        L --> M[我的订单列表];
    end

    G --> I;
    F --> G;

    subgraph 订单交互
        M --> N{订单状态更新};
        N --> O[买家/卖家确认];
        O --> P[订单完成/取消];
    end

    A --> Q[用户个人中心];
    Q --> F;
    Q --> M;
```

##### 1.2 注册/登录流程细化

```mermaid
graph TD
    A[用户] --> B[进入App或Web];
    B --> C{是否已登录?};
    C -- 是 --> D[进入主页或物品列表];
    C -- 否 --> E[显示登录或注册界面];
    E -- 选择注册 --> F[注册流程];
    E -- 选择登录 --> G[登录流程];

    subgraph 注册
        F --> F1[输入用户名 邮箱 密码];
        F1 --> F2[提交注册请求];
        F2 -- 注册成功 --> G[进入登录流程];
        F2 -- 注册失败 --> F3[显示错误信息<br>返回F1];
    end

    subgraph 登录
        G --> G1[输入用户名/邮箱 密码];
        G1 --> G2[提交登录请求];
        G2 -- 登录成功 --> D[进入主页或物品列表];
        G2 -- 登录失败 --> G3[显示错误信息<br>返回G1];
    end
```

#### **2. 关键页面示意图**

##### 2.1 登录/注册页面示意图

```mermaid
graph TD
    A[登录或注册页] --> A1[顶部Logo或标题: 校享易];
    A1 --> A2[选择Tab: 登录 / 注册];

    subgraph 登录表单
        A2 -- 登录选中 --> A3[用户名输入框];
        A3 --> A4[密码输入框];
        A4 --> A5[登录按钮];
        A5 --> A6[忘记密码? 或 立即注册];
    end

    subgraph 注册表单
        A2 -- 注册选中 --> A7[用户名输入框];
        A7 --> A8[邮箱输入框];
        A8 --> A9[密码输入框];
        A9 --> A10[确认密码输入框];
        A10 --> A11[注册按钮];
        A11 --> A12[已有账号? 去登录];
    end
```

##### 2.2 物品列表页示意图

```mermaid
graph TD
    A[物品列表页] --> A1[顶部导航栏<br>左: 返回或Logo - 中: 搜索框 - 右: 消息或发布];
    A1 --> A2[分类筛选区<br>热门 - 书籍 - 电子产品 - ...];
    A2 --> A3[物品列表区];

    A3 --> Item1[物品卡片1];
    Item1 --> Item1_img[物品图片];
    Item1 --> Item1_title[物品标题];
    Item1 --> Item1_price[价格];
    Item1 --> Item1_owner[发布者头像或昵称];

    A3 --> Item2[物品卡片2];
    Item2 --> Item2_img[物品图片];
    Item2 --> Item2_title[物品标题];
    Item2 --> Item2_price[价格];
    Item2 --> Item2_owner[发布者头像或昵称];

    A3 --> ItemN[...更多物品卡片];

    A3 --> A4[加载更多或分页器];
    A4 --> A5[底部Tab导航<br>首页 - 发布 - 消息 - 我的];
```

##### 2.3 物品详情页示意图

```mermaid
graph TD
    A[物品详情页] --> A1[顶部导航栏<br>左: 返回 - 右: 分享或收藏];
    A1 --> A2[物品图片轮播];
    A2 --> A3[物品基本信息区];
    A3 --> A3_1[标题];
    A3 --> A3_2[价格];
    A3 --> A3_3[状态 在售或已售];
    A3 --> A3_4[发布时间];
    A3 --> A4[发布者信息区];
    A4 --> A4_1[发布者头像或昵称];
    A4 --> A4_2[发布者简介或信用];
    A4 --> A4_3[私聊TA按钮];
    A4 --> A5[物品详细描述区<br>长文本描述];
    A5 --> A6[底部操作区];
    A6 --> A6_1[收藏按钮];
    A6 --> A6_2[购买按钮];
```

##### 2.4 发布物品页面示意图

```mermaid
graph TD
    A[发布物品页] --> A1[顶部导航栏<br>左: 返回 - 中: 发布闲置 - 右: 发布];
    A1 --> A2[图片上传区<br>点击上传或拖拽上传<br>支持多图预览];
    A2 --> A3[表单区域];
    A3 --> A3_1[标题输入框];
    A3 --> A3_2[分类选择器];
    A3 --> A3_3[价格输入框];
    A3 --> A3_4[详细描述文本域];
    A3 --> A4[提交发布按钮];
```

##### 2.5 我的订单列表页面示意图

```mermaid
graph TD
    A[我的订单列表页] --> A1[顶部导航栏<br>左: 返回 - 中: 我的订单 - 右: 筛选];
    A1 --> A2[订单状态筛选Tab<br>全部 - 进行中 - 已完成 - 已取消];
    A2 --> A3[订单列表区];

    A3 --> Order1[订单卡片1];
    Order1 --> Order1_status[订单状态 进行中];
    Order1 --> Order1_item_img[物品小图];
    Order1 --> Order1_item_title[物品标题];
    Order1 --> Order1_item_price[价格];
    Order1 --> Order1_buyer_seller[买家或卖家信息];
    Order1 --> Order1_action[操作按钮 联系对方/确认收货/取消订单];

    A3 --> Order2[订单卡片2];
    Order2 --> Order2_status[订单状态 已完成];
    Order2 --> Order2_item_img[物品小图];
    Order2 --> Order2_item_title[物品标题];
    Order2 --> Order2_item_price[价格];
    Order2 --> Order2_buyer_seller[买家或卖家信息];
    Order2 --> Order2_action[操作按钮 查看详情/评价];

    A3 --> OrderN[...更多订单卡片];

    A3 --> A4[加载更多或分页器];
    A4 --> A5[底部Tab导航<br>首页 - 发布 - 消息 - 我的];
```



